const edit=!1,nowObj=null;REC=!1,REP=!1,RECT=0,SAVE=void 0,KD=[],KU=[],KD[vk_shift]='SH',KU[vk_shift]='sh',KD[vk_left]='LF',KU[vk_left]='lf',KD[vk_right]='RT',KU[vk_right]='rt',KD[vk_Z]='Z',KU[vk_Z]='z',KD[vk_S]='S',KU[vk_S]='s',KDR=[],KUR=[];const objTime=function(){var e=Date.now(),o=Date.now();Time.time=0,Death.innerText='0';var a=0;RECT=0,SRECT=0,RECO={SH:'',sh:'',LF:'',lf:'',RT:'',rt:'',Z:'',z:'',S:'',s:'',0:'',1:'',2:'',3:'',4:'',5:'',6:'',7:'',8:'',9:''},SRECO={...RECO},UPRK=!1,this.getTime=()=>(Date.now()-e)/1e3,this.addDeaths=()=>{a+=1},this.getDeaths=()=>a,this.pause=()=>{pause=!pause,pause?(Loading.style.display='block',o=Date.now()):(e+=Date.now()-o,Loading.style.display='none')},this.strep=e=>{repl=e.ind+1,o=Date.now()},this.resume=()=>{saveX=REPBF.x,saveY=REPBF.y,JumpNum=REPBF.j,room_load(!0,!0),e+=Date.now()-o,RECT=REPBF.r,SRECT=REPBF.s,RECO={...REPBF.o},SRECO={...RECO}}};function room_load(e,o,a){if(roomInit(),loadRoom(),a)return!1;o||(saveX=startX,saveY=startY,JumpNum=1,BKEF=[]),blood=null,scrT.clearRect(0,0,tiles.width,tiles.height),drawInit(),resetGUI(),GCB.style.transform='translateX(-50%) translateY(-50%) scale(0) rotate(0deg)',$('ach').style.top='400px',player&&(0===ViewMode?(toVX=Math.min(RoomW-800,Math.max(0,800*(player.x/800<<0))),toVY=Math.min(RoomH-608,Math.max(0,608*(player.y/608<<0)))):(toVX=Math.max(400,Math.min(player.x,RoomW-400))-400,toVY=Math.max(304,Math.min(player.y,RoomH-304))-304),RViewX=toVX,RViewY=toVY,ViewX=Math.round(RViewX),ViewY=Math.round(RViewY),activate()),shooter.length>9&&(oBGM.currentTime=0)}function evDraw(){if(drawBegin(),drawBGEF(),draw_obj(field),spike.forEach(e=>{'objSpike'!==e.__proto__.constructor.name&&e.draw_self(scr)}),block.forEach(e=>{'objCrate'!==e.__proto__.constructor.name&&'objBreakableBlock'!==e.__proto__.constructor.name||e.draw_self()}),draw_obj(conveyor),draw_obj(GMStepObj),draw_obj(GMColObj,scr),draw_obj(platform),draw_obj(cherry,scr),draw_obj(bullet,0,!0),draw_obj(objEf,0,!0),player&&player.draw_self(),blood){if(blood.length<50)for(var e=5;e--;)blood.push(new objBlood(bloodX,bloodY));blood.forEach(e=>e.draw_self())}warpEnd.draw_self(scr),draw_obj(warp,scr),draw_obj(water),drawEf();for(let e in USERS){let[o,a,r,t,s]=USERS[e];switch(o){case'i':o=sprPlayerIdle;break;case'r':o=sprPlayerRun;break;case'j':o=sprPlayerJump;break;case'f':o=sprPlayerFall;break;case's':o=sprPlayerSlide}scr.globalAlpha=.5,s<0?(scr.save(),scr.scale(-1,1),scr.drawImage(o[a],-r-17,t-23),scr.restore()):scr.drawImage(o[a],r-17,t-23),scr.fillStyle='#FFFFFF',scr.fillText(e,r,t-24),scr.strokeStyle='#000000',scr.strokeText(e,r,t-24),scr.globalAlpha=1}if(!END&&!REP&&oTime){Time.time=oTime.getTime();let e=Time.time%60;e-(e<<0)<.03&&(Time.innerText=cov((Time.time-e)/60)+':'+cov(e<<0))}}function GameRun(){if(repl&&(replay(RANK[repl-1].R),repl=!1,REPIND=repl),key_check(vk_P),keyboard_check_pressed(vk_P)&&oTime.pause(),pause?keyPause():keyDown[82]?(REP||OnUp||(keyPause(),END?(room_load(),oTime=new objTime,END=!1):(room_load(!0,!0),RECT=SRECT,RECO={...SRECO})),keyDown[82]=!1):keyDown[116]&&(REP||OnUp||(keyPause(),room_load(),oTime=new objTime,END=!1),keyDown[116]=!1),key_check(vk_right),key_check(vk_left),key_check(vk_up),key_check(vk_down),key_check(vk_shift),key_check(vk_Z),key_check(vk_S),pause||(END||(evStep(),BGEF(),evMove()),evDraw(),RECT+=1),4===nowTab){keyShow[0].style.background=key[vk_shift]?'#dddddd':'',keyShow[1].style.background=key[vk_Z]?'#dddddd':'',keyShow[2].style.background=key[vk_left]?'#dddddd':'',keyShow[3].style.background=key[vk_right]?'#dddddd':'',keyShow[4].style.background='';for(let e=0;e<10;e++){let o=RECO[e].charCodeAt(0)-100;if(o<=RECT&&o>RECT-10){keyShow[4].style.background='#dddddd',RECO[e]=RECO[e].slice(1);break}}}if(key_clear(vk_right),key_clear(vk_left),key_clear(vk_up),key_clear(vk_down),key_clear(vk_shift),key_clear(vk_Z),key_clear(vk_S),key_clear(vk_P),!REP&&!END&&!pause&&Date.now()%50<20){let e=0;for(let o in USERS)e++;e&&pushData()}}function replay(e){keyPause(),key_check(vk_right),key_check(vk_left),key_check(vk_shift),key_check(vk_Z),key_check(vk_S),REPBF={},REPBF.o={...RECO},REPBF.r=RECT,REPBF.s=SRECT,REPBF.x=saveX,REPBF.y=saveY,REPBF.j=JumpNum,RECO={...e},RECT=0,SRECT=0,REC=!1,REP=!0,END=!1,KDR[vk_shift]=0,KUR[vk_shift]=0,KDR[vk_left]=0,KUR[vk_left]=0,KDR[vk_right]=0,KUR[vk_right]=0,KDR[vk_Z]=0,KUR[vk_Z]=0,KDR[vk_S]=0,KUR[vk_S]=0,room_load(),keyPause()}END=!1,BGx=0,BGy=0,BKEF=[],scr.textAlign='center',scr.font='bold 13px sans-serif',repl=!1,REPIND=void 0,keyShow=tab[4].getElementsByClassName('key');