function readRoom(e){var t,o=e.V,a=e.B;if(a.length>0&&(t=o<.5?{n:2,o:block,obj:objBlock,change(e){switch(this.f=void 0,e){case 10:this.o=water,this.obj=objWater;break;case 11:this.o=block,this.obj=objIceBlock;break;case 12:case 13:case 14:case 15:this.o=field,this.obj=objField,this.f=e-12}},set(e){this.w=e[0],this.h=e[1]},create(e,t){this.obj==objField?this.o.push(new this.obj(e,t,this.w,this.h,this.f)):this.o.push(new this.obj(e,t,this.w,this.h))}}:{n:1,o:block,obj:objBlock,change(e){switch(e){case 10:this.o=water,this.obj=objWater;break;case 11:this.o=block,this.obj=objIceBlock;break;case 12:case 13:case 14:case 15:this.o=field,this.obj=objField,this.f=e-12;break;case 16:this.o=trigger,this.obj=objTrigger}},set(e){this.w=32*(e[0]>>5),this.h=32*(e[0]-this.w)},create(e,t){this.obj==objField?this.o.push(new this.obj(e,t,this.w,this.h,this.f)):this.o.push(new this.obj(e,t,this.w,this.h))}},readStr(a,t)),(a=e.S).length>0&&readStr(a,t={n:3,set(e){this.w=e[0],this.h=e[1],this.ang=e[2]},create(e,t){let o=spike.push(new objSpike(e,t,this.ang,spike.length));spike[o-1].setScale(this.w,this.h)}}),(a=e.O).length>0&&(t={n:0,o:GMStepObj,change(e){switch(e){case 10:this.obj=objSavePoint;break;case 11:this.obj=objWallJump,this.o=Walljump,this.side=-1;break;case 13:this.obj=objWallJump,this.o=Walljump,this.side=1;break;case 12:this.obj=objCrate,this.o=block;break;case 14:this.obj=objJumpRefresher,this.o=GMColObj,sndInit('sndExtraJump');break;case 15:case 16:case 17:case 18:this.obj=objJumpChanger,this.o=GMColObj,this.num=18===e?1/0:e-15,sndInit('sndGainJump'),sndInit('sndLoseJump');break;case 19:case 20:case 21:this.obj=objFake,this.o=GMColObj,this.num=e-19,sndInit('sndBreak');break;case 22:this.obj=objBreakableBlock,this.o=block,sndInit('sndBreak')}},create(e,t){this.o===Walljump?this.o.push(new this.obj(e,t,this.side)):this.obj===objJumpChanger||this.obj===objFake?this.o.push(new this.obj(e,t,this.num)):this.o.push(new this.obj(e,t))}},readStr(a,t)),(a=e.O2).length>0&&(t={n:2,o:platform,obj:objPlatform,change(e){switch(e){case 10:this.o=cherry,this.obj=objCherry;break;case 11:this.o=GMColObj,this.obj=objSpring,sndInit('sndSpring');break;case 12:this.o=GMColObj,this.obj=objTrampoline,sndInit('sndSpring');break;case 13:this.o=conveyor,this.obj=objConveyor,this.fx=0;break;case 14:this.o=conveyor,this.obj=objConveyor,this.fx=1}},set(e){this.hspd=e[0]/10,this.vspd=e[1]/10},create(e,t){var o=this.o.push(new this.obj(e,t));this.obj===objSpring||this.obj===objTrampoline?(this.o[o-1].ang=10*this.hspd,this.o[o-1].spd=10*this.vspd):this.o===conveyor?(this.o[o-1].fx=this.fx,this.o[o-1].CW=10*this.hspd,this.o[o-1].spd=this.vspd):(this.o[o-1].hspeed=this.hspd,this.o[o-1].vspeed=this.vspd)}},readStr(a,t)),(a=e.O3||'').length>0&&(t={n:3,o:warp,obj:objWarp,change(e){e},set(e){this.a1=e[0],this.a2=e[1],this.a3=e[2]},create(e,t){var o=this.o.push(new this.obj(e,t));this.obj===objWarp&&(this.o[o-1].warpX=this.a1,this.o[o-1].warpY=this.a2,this.o[o-1].k=this.a3)}},readStr(a,t)),(a=e.O4).length>0&&(t={n:4,o:Rcherry,obj:objRoundingCherry,i:0,change(e){switch(e){case 10:this.obj=objRoundingCherry;break;case 11:this.obj=objSpikeGear;break;default:this.o=shooter,this.obj=objShooter,this.i=e-12}},set(e){this.a1=e[0],this.a2=e[1],this.a3=e[2],this.a4=e[3]},create(e,t){var o;this.o.push(new this.obj(e,t,this.i)),this.o===Rcherry?((o=Rcherry[Rcherry.length-1]).n=this.a1,o.r=this.a2,o.spd=this.a3/10,o.ang=this.a4):((o=shooter[shooter.length-1]).n=this.a1,o.spd=this.a2/10,o.t=this.a3,o.ang=this.a4)}},readStr(a,t)),(a=e.Bd||'').length>0)for(var s=0;s<a.length;s++){if(-100===StN(a.charAt(s))){s+=1;var h=1;1===StN(a.charAt(s))&&(h=-1,s+=1);var i=cNum(a.charAt(s))*h;h=1,s+=1,1===StN(a.charAt(s))&&(h=-1,s+=1);for(var r=cNum(a.charAt(s))*h,l='';s+1<a.length&&-100!==StN(a.charAt(s+1));)s+=1,l+=a.charAt(s);board.push(new objBoard(i,r,l))}}}const readStr=(e,t)=>{for(var o=0;o<e.length;o++){var a=1,s=StN(e.charAt(o));if(1!==s&&s<100){o+=1;for(var h=[],i=0;i<t.n;i++){var r=1;1===StN(e.charAt(o))&&(r=-1,o+=1),h.push(cNum(e.charAt(o))*r),o+=1}t.change&&t.change(s),t.set&&t.set(h)}1===StN(e.charAt(o))&&(a=-1,o+=1);var l=cNum(e.charAt(o))*a;a=1,o+=1,1===StN(e.charAt(o))&&(a=-1,o+=1);var c=cNum(e.charAt(o))*a;t.create(l,c)}};function roomInit(){block=[],spike=[],bullet=[],platform=[],water=[],field=[],cherry=[],cherry.ind=0,cherry.img_spd=1/15,Rcherry=[],shooter=[],Walljump=[],warp=[],GMStepObj=[],GMColObj=[],conveyor=[],objEf=[],board=[],trigger=[]}function evStep(){platform.forEach(e=>e.evStep()),player&&player.evStep(),bullet.forEach(e=>e.evStep()),GMStepObj.forEach(e=>e.evStep())}function evMove(){cherry.ind+=cherry.img_spd,cherry.ind=cherry.ind%2,BKEF.forEach(e=>e.move()),warpEnd.move(),warp.forEach(e=>e.move()),move(field),move(platform),move(block),move(Rcherry),move(shooter),spike.forEach(e=>{void 0!==e.rid&&Rcherry[e.rid].inView&&e.move()}),cherry.forEach(e=>{void 0!==e.rid?(e.inView=!0,Rcherry[e.rid].inView&&e.move()):e.inView&&e.move()}),move(conveyor),player&&player.move(),board.forEach(e=>e.move()),objEf.forEach(e=>e.move()),edit||(PViewX=ViewX,PViewY=ViewY,0===ViewMode?player&&(ViewX=Math.min(RoomW-800,Math.max(0,800*(player.x/800<<0))),ViewY=Math.min(RoomH-608,Math.max(0,608*(player.y/608<<0)))):(player&&(toVX=Math.max(400,Math.min(player.x,RoomW-400))-400,toVY=Math.max(304,Math.min(player.y,RoomH-304))-304),RViewX+=(toVX-RViewX)/20,RViewY+=(toVY-RViewY)/20,ViewX=Math.round(RViewX),ViewY=Math.round(RViewY)),0===BGhspd&&0===BGvspd||(BGx+=BGhspd,BGy+=BGvspd),PViewX===ViewX&&PViewY===ViewY||activate())}function drawBegin(){drawVX=ViewX-50,drawVY=ViewY-50,3===BGMode&&'center center'!==BackGround.style.backgroundPosition&&(BackGround.style.backgroundPosition=`${BGx-ViewX}px ${BGy-ViewY}px`),scr.setTransform(1,0,0,1,-ViewX,-ViewY),scr.clearRect(ViewX,ViewY,scrn.width,scrn.height)}function drawInit(){player=new objPlayer(saveX,saveY),Rcherry.forEach(e=>{e.createR()}),spike.forEach(e=>{'objSpike'===e.__proto__.constructor.name&&e.draw_self(scrT)}),block.forEach(e=>{'objCrate'!==e.__proto__.constructor.name&&'objBreakableBlock'!==e.__proto__.constructor.name&&e.draw_self()}),draw_obj(Walljump,0,!0),draw_obj(board,0,!0),1===OutMode&&(block.push(new objBlock(-32,-32,RoomW+64,32)),block.push(new objBlock(-32,0,32,RoomH)),block.push(new objBlock(RoomW,0,32,RoomH))),void 0!==SAVE&&(GMStepObj[SAVE].ind=1,GMStepObj[SAVE].img_spd=.02,SAVE=void 0),FlashSpd=0,FlashAl=0,toFlAl=0,FlashCol='#000',WarpR=null}function resetGUI(){Bd.style.visibility='hidden',GUI.style.visibility='hidden',GUI.style.opacity='0',GUI.style.transition="none",GCobj[0].style.right='880px',GCobj[1].style.left='880px',GCobj[0].style.top='0',GCobj[1].style.top='0',GCobj[2].style.top='400px'}function BGEF(){if(EF.length<8)return!1;if(EFtimer+=1,EFtimer>=EF[6]){var e,t=(Math.random()-.5)/6,o=EF[1]+(2*Math.random()-1)*EF[2];switch(EF[7]){case 0:(e=BKEF[BKEF.push(new objBKEF(800*Math.random(),608+(o>>1),EF[0],o))-1]).v=-EF[3]+(2*Math.random()-1)*EF[4];break;case 1:(e=BKEF[BKEF.push(new objBKEF(800*Math.random(),-(o>>1),EF[0],o))-1]).v=EF[3]+(2*Math.random()-1)*EF[4];break;case 2:(e=BKEF[BKEF.push(new objBKEF(-(o>>1),608*Math.random(),EF[0],o))-1]).h=EF[3]+(2*Math.random()-1)*EF[4];break;case 3:(e=BKEF[BKEF.push(new objBKEF(800+(o>>1),608*Math.random(),EF[0],o))-1]).h=-EF[3]+(2*Math.random()-1)*EF[4];break;case 4:e=BKEF[BKEF.push(new objBKEF(400,304,EF[0],o))-1];let t=EF[3]+(2*Math.random()-1)*EF[4],a=2*Math.random()*Math.PI;e.h=t*Math.cos(a),e.v=t*Math.sin(a)}e.aspd=t,EFtimer=0}}function drawBGEF(){if('u'===BackGround.style.background[13]&&Date.now()%80<20){let e=6,t=0;for(sfbg.clearRect(0,0,800,608),sfbg.fillStyle='#F2F4';e<96;e+=32)sfbg.fillRect(e,0,20,200*Math.random()),t=200*Math.random(),sfbg.fillRect(780-e,608-t,20,t);for(sfbg.fillStyle='#FF24';e<192;e+=32)sfbg.fillRect(e,0,20,200*Math.random()),t=200*Math.random(),sfbg.fillRect(780-e,608-t,20,t);for(sfbg.fillStyle='#22F4';e<352;e+=32)sfbg.fillRect(e,0,20,200*Math.random()),t=200*Math.random(),sfbg.fillRect(780-e,608-t,20,t);for(sfbg.fillStyle='#2F24';e<512;e+=32)sfbg.fillRect(e,0,20,200*Math.random()),t=200*Math.random(),sfbg.fillRect(780-e,608-t,20,t);for(sfbg.fillStyle='#2FF4';e<672;e+=32)sfbg.fillRect(e,0,20,200*Math.random()),t=200*Math.random(),sfbg.fillRect(780-e,608-t,20,t);for(sfbg.fillStyle='#F224';e<800;e+=32)sfbg.fillRect(e,0,20,200*Math.random()),t=200*Math.random(),sfbg.fillRect(780-e,608-t,20,t)}if(EF.length>7){let e=scr;switch(e.fillStyle=EF[8],e.strokeStyle=EF[8],e.globalAlpha=EF[5],EF[0]){case 0:e.beginPath(),BKEF.forEach(e=>e.draw0()),e.stroke();break;case 1:e.beginPath(),BKEF.forEach(e=>e.draw1()),e.stroke();break;case 2:BKEF.forEach(e=>e.draw2());break;case 3:e.beginPath(),BKEF.forEach(e=>e.draw1()),e.fill();break;case 4:case 5:case 6:e.imageSmoothingEnabled=!0,BKEF.forEach(e=>e.draw3()),e.imageSmoothingEnabled=!1}e.globalAlpha=1}}function drawEf(){saveEf.length>0&&saveEf[0].al<=0&&(saveEf=[]),draw_obj(saveEf,0,!0),0!==FlashSpd&&(FlashAl>toFlAl?FlashAl-=FlashSpd:FlashAl<toFlAl?FlashAl+=FlashSpd:FlashSpd=0),FlashAl>0&&(scr.globalAlpha=FlashAl/100,scr.fillStyle=FlashCol,scr.fillRect(ViewX,ViewY,800,608),scr.globalAlpha=1),WarpR&&(scr.save(),scr.translate(ViewX+400,ViewY+304),scr.rotate(WarpR.ang),scr.fillStyle='#000',scr.fillRect(1.32*-WarpR.sc,-WarpR.sc,1.32*WarpR.sc<<1,WarpR.sc<<1),scr.restore())}function EFSprinit(){for(var e=sprPt.length;e--;){let t=document.createElement('canvas');t.width=64,t.height=64;let o=t.getContext('2d');o.drawImage(sprPt[e],0,0),o.globalCompositeOperation='source-in',o.fillStyle=EF[8],o.fillRect(0,0,64,64),sprPt[e]=t}}saveEf=[],EFtimer=0;