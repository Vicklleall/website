function resetlog(){taba.style.color='#666',taba.style.backgroundColor='#FFF',tabb.style.color='#888',tabb.style.backgroundColor='#F0F0F0',pw.type='password',log.innerText='登录',sets(sa,'',un,1,1),sets(sb,'',pw,1,1),sets(sc,''),un.value='',pw.value='',forget&&(forget.style.display='block')}function loga(){can&&(log.innerText+='中',can=!1,log.style.backgroundColor='hsla(202,100%,60%,1)')}function logb(e){can||(log.innerText=e,can=!0,log.style.backgroundColor='hsla(200,100%,50%,1)')}function sets(e,s,t,o,n){o?(o='#666',n='#AAA'):n=o='#FF4444',e.style.color=o,e.innerText=' '+s,t&&(t.style.borderColor=n)}taba=$('taba'),tabb=$('tabb'),un=$('un'),pw=$('pw'),sa=$('sa'),sb=$('sb'),sc=$('sc'),log=$('log'),forget=$('forget'),un.maxLength=20,pw.maxLength=16,can=!0,taba.onclick=resetlog,tabb.onclick=()=>{can&&(tabb.style.color='#666',tabb.style.backgroundColor='#FFF',taba.style.color='#888',taba.style.backgroundColor='#F0F0F0',pw.type='none',log.innerText='注册',sets(sa,'（2～20字符）',un,1,1),sets(sb,'（6～16字符）',pw,1,1),sets(sc,''),un.value='',pw.value='',forget&&(forget.style.display='none'))},log.onclick=function(){if(can)if(sets(sc,''),'注册'===this.innerText)if(un.value.length<2)sets(sa,'（2～20字符）',un);else if(pw.value.length<6)sets(sb,'（6～16字符）',pw);else{var e=new AV.User;e.setUsername(un.value),e.setPassword(pw.value);var s=dcodeIO.bcrypt.hashSync(pw.value,10);e.signUp().then(e=>{e.set('bpw',s),e.set('hasBpw',!0),e.save().then(()=>{FuncLogIn(e),logb('注册')})},e=>{202==e.code?sets(sa,'该用户名已被注册',un):"Forbidden to create by class '_User' permissions."==e.rawMessage?sets(sc,'公测已结束，敬请期待新版！'):sets(sc,'注册失败'),logb('注册')}),loga()}else{s=dcodeIO.bcrypt.hashSync(pw.value,10);AV.User.logIn(un.value,pw.value).then(e=>{e.set('bpw',s),e.set('hasBpw',!0),e.save().then(()=>{FuncLogIn(e),logb('登录')})},e=>{211==e.code?sets(sa,'该用户不存在',un):210==e.code?sets(sb,'密码错误',pw):219==e.code?sets(sc,'登录失败次数过多，请15分钟后再次尝试'):sets(sc,'登录失败'),logb('登录')}),loga()}},un.onclick=()=>{'注册'===log.innerText?sets(sa,'（2～20字符）',un,1,1):sets(sa,'',un,1,1),sets(sc,'')},pw.onclick=()=>{'注册'===log.innerText?sets(sb,'（6～16字符）',pw,1,1):sets(sb,'',pw,1,1),sets(sc,'')},forget&&(forget.onclick=()=>{var e=prompt('请输入注册邮箱地址：');e&&AV.User.requestPasswordReset(e).then(()=>{alert('请求已发送，请检查您的邮箱！')},e=>{205==e.code?alert('邮箱地址错误！'):alert('请求发送失败！')})});