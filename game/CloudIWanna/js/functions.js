function cov(e){return e<10?'0'+e:e}const PI=Math.PI,roundFix=e=>Math.round(e.toFixed(1));function initKey(e){keyDown[e]=!1,keyUp[e]=!1,key[e]=!1}function sign(e){return(e>0)-(e<0)}function draw_obj(e,t,o=!1){e.forEach(e=>{(edit||o||e.inView)&&e.draw_self(t)})}function move(e){e.forEach(e=>{e.move&&e.inView&&e.move()})}function activate(){act_obj(field),act_obj(platform),act_obj(block),act_obj(Rcherry),act_obj(shooter),act_obj(spike),act_obj(conveyor),act_obj(GMStepObj),act_obj(GMColObj),act_obj(cherry),act_obj(bullet),act_obj(warp),act_obj(water),tiles.style.transform=`translate(-${ViewX}px,-${ViewY}px)`}function act_obj(e){e.forEach(e=>{if(e.drawW)var t=e.cX-e.drawW,o=e.cY-e.drawH,i=2*e.drawW,n=2*e.drawH;else if(e.r)t=e.x-e.r,o=e.y-e.r,n=i=2*e.r;else t=e.x,o=e.y,i=e.w,n=e.h;e.Ox&&(t-=e.Ox),e.Oy&&(o-=e.Oy),e.inView=colRect(ViewX,ViewY,800,608,t,o,i,n)})}function key_check(e){REP&&void 0!==RECO[KD[e]]&&(RECO[KD[e]].charCodeAt(KDR[e])-100===RECT?(keyDown[e]=!0,KDR[e]+=1):keyDown[e]=!1,RECO[KU[e]].charCodeAt(KUR[e])-100===RECT?(keyUp[e]=!0,KUR[e]+=1):keyUp[e]=!1);keyDown[e]?key[e]||(key[e]=!0):keyUp[e]&&key[e]&&(key[e]=!1),REC&&void 0!==KD[e]&&(keyDown[e]&&(RECO[KD[e]]+=NtS(RECT)),keyUp[e]&&(RECO[KU[e]]+=NtS(RECT)))}function key_clear(e){keyUp[e]&&key[e]&&(key[e]=!1),keyDown[e]=!1,keyUp[e]=!1}function key_pause(e){key[e]&&(key[e]=!1,keyUp[e]=!0),keyDown[e]=!1}function keyboard_check(e){return key[e]}function keyboard_check_pressed(e){return keyDown[e]}function keyboard_check_released(e){return keyUp[e]}function draw_sprite_angle(e,t,o,i,n,a,r,c=1,l=1){var s=n*PI/180;e.save(),e.translate(o,i),e.rotate(-s),1===c&&1===l||(e.scale(c,l),a/=c,r/=l,(Math.abs(c)<1||Math.abs(l)<1)&&(e.imageSmoothingEnabled=!0)),e.drawImage(t,-a,-r),e.restore(),e.imageSmoothingEnabled=!1}function colRect(e,t,o,i,n,a,r,c){return!(e+o<=n||e>=n+r||t+i<=a||t>=a+c)}function colRP(e,t,o,i,n,a,r,c,l){if(colsf.clearRect(0,0,colSF.width,colSF.height),colsf.save(),colsf.translate(16-ViewX,16-ViewY),n.draw_self(colsf),colsf.restore(),void 0!==a){let n=roundFix(Math.min(e+o,a+c)),y=roundFix(Math.min(t+i,r+l));if(e=roundFix(e<a?a:e),t=roundFix(t<r?r:t),n-e<=0||y-t<=0)return!1;var s=colsf.getImageData(e+16-ViewX,t+16-ViewY,n-e,y-t).data}else s=colsf.getImageData(e+16-ViewX,t+16-ViewY,o,i).data;for(var y=3;y<s.length;y+=4)if(s[y]>0)return!0;return!1}function colRO(e,t,o,i,n,a,r){if(a)var c=[];for(var l=0;l<n.length;l++)if(n[l].id!==r){if(n[l].drawW)var s=n[l].cX-n[l].drawW,y=n[l].cY-n[l].drawH,d=2*n[l].drawW,f=2*n[l].drawH;else s=n[l].x,y=n[l].y,d=n[l].w,f=n[l].h;if(n[l].Ox&&(s-=n[l].Ox),n[l].Oy&&(y-=n[l].Oy),colRect(e,t,o,i,s,y,d,f))if(n[l].pxmask){if(colRP(e,t,o,i,n[l],s,y,d,f)){if(!a)return n[l];c.push(n[l])}}else{if(!a)return n[l];c.push(n[l])}}return!!(a&&c.length>0)&&c}function pos_obj(e,t,o){for(var i=o.length;i--;){if(o[i].drawW)var n=o[i].cX-o[i].drawW,a=o[i].cY-o[i].drawH,r=2*o[i].drawW,c=2*o[i].drawH;else n=o[i].x-(o[i].Ox||0),a=o[i].y-(o[i].Oy||0),r=o[i].w,c=o[i].h;if(n<=e&&a<=t&&n+r>e&&a+c>t)return o[i]}return!1}function instance_place(e,t,o){for(var i=[],n=o.length-1;n>-1;n--)o[n].x===e&&o[n].y===t&&i.push(o[n]);return i.length>0&&i}function killPlayer(){sndPlay(sndDeath),blood=[],bloodX=player.x,bloodY=player.y;for(let e=0;e<10;e++)blood.push(new objBlood(bloodX,bloodY));END||REP||(oTime?(oTime.addDeaths(),Death.innerText=oTime.getDeaths()):(Death.death+=1,Death.innerText=Death.death),GO.style.visibility='visible',GC.style.visibility='hidden',GUI.style.transition="opacity 1s 0.4s",GUI.style.visibility='visible',GUI.style.opacity='1'),player=null}function destroy(e,t){nowObj===e[t]&&(nowObj=null,resetPro()),e.evDes&&e[t].evDes(),e.splice(t,1);for(var o=0;o<e.length;o++)e[o].id>t&&(e[o].id-=1)}function DtoR(e){return e/180*PI}function setTab(e){nowTab=e.ind;for(var t=0;t<tab.length;t++)tab[t].style.left=500*(t-e.ind)+'px'}vk_shift=16,vk_ctrl=17,LRshift=1,vk_left=37,vk_right=39,vk_up=38,vk_down=40,vk_Z=90,vk_S=83,vk_P=80,keyDown=[],keyUp=[],key=[],initKey(vk_ctrl),initKey(vk_shift),initKey(vk_right),initKey(vk_left),initKey(vk_up),initKey(vk_down),initKey(vk_Z),initKey(vk_S),document.onkeydown=e=>{if(9===e.keyCode&&e.preventDefault(),'textarea'===document.activeElement.type||'input'===document.activeElement.type)return!0;if(e=e||window.event){if(!e.code)return!0;if(e.keyCode===vk_shift&&e.location!==LRshift){if('ShiftLeft'!==e.code&&'ShiftRight'!==e.code)return!0;LRshift=e.location,keyDown[e.keyCode]=!0}key[e.keyCode]||(keyDown[e.keyCode]=!0),REC&&!e.repeat&&e.code.startsWith("Numpad")&&(RECO[e.code.slice(-1)]+=NtS(RECT))}},document.onkeyup=e=>{if(e=e||window.event){if(!e.code)return!0;e.preventDefault(),keyUp[e.keyCode]=!0}},oTime=null,icoarea=$('icoarea'),nowTab=0,ico=icoarea.getElementsByClassName('ico'),tab=document.getElementsByClassName('tab');for(var i=0;i<ico.length;i++)ico[i].ind=i,ico[i].onclick=function(){canPut=!1,setTab(this);for(var e=0;e<ico.length;e++)ico[e].style.backgroundColor='#E6E6E6';this.style.backgroundColor='#CCC'};function save_ef(){sfscr.clearRect(0,0,800,608),sfscr.drawImage(tiles,-ViewX,-ViewY),sfscr.drawImage(scrn,0,0);for(var e=0;e<800;e+=200)for(var t=0;t<608;t+=152)saveEf.push(new objSaveEf(e,t))}function keyPause(){key_pause(vk_right),key_pause(vk_left),key_pause(vk_shift),key_pause(vk_Z),key_pause(vk_S)}function breakEF(e){sndPlay(sndBreak);let t=4*Math.random()-2,o=Math.random()-2,i=objEf.push(new objParticle(e.x+16,e.y+16,e.spr,0,0,.05)),n=objEf[i-1];n.grav=.2,n.hspd=t,n.vspd=o}Time=$('Time'),Death=$('Deaths'),Time.time=0,Death.death=0;