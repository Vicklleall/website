function objInit(s,t,i,h,e,r=32,a=32){s.obj_ind=t,s.id=t.length,s.spr=i,s.x=h,s.y=e,s.w=r,s.h=a}function GG(s,t){return Math.sqrt(s*s+t*t)}function centerSpr(s,t=!1){t?(s.sprX=s.spr[0].width>>1,s.sprY=s.spr[0].height>>1,s.w=Math.ceil(GG(s.spr[0].width,s.spr[0].height)),s.h=s.w):(s.w=s.spr[0].width,s.h=s.spr[0].height),s.Ox=s.w>>1,s.Oy=s.h>>1}Trans=0;const objWarp=class{constructor(s,t,i=!1){this._x=s,this._y=t,this.cX=s+16,this.cY=t+16,this.warpX=this.cX,this.warpY=this.cY,this.w=32,this.h=32,this.savejn=1,this.spr=sprWarp,this.pxmask=!0,this.img_ang=0,this.k=Trans,this.timer=0,this.spr[0].src.includes('/NANG/')?this.spd=1:this.spd=0,i||(this.obj_ind=warp,this.id=warp.length)}Warp(){switch(this.savejn=player.jumpNum,this.k){case 0:FlashCol='#000',toFlAl=100,FlashSpd=4,this.timer=30,player=null;break;case 1:this.px=player.x,this.py=player.y,this.timer=100,player=null;break;case 2:WarpR=this,this.sc=0,this.ang=0,this.timer=64,objEf.push(new objParticle(player.x-1*player.image_xscale,player.y-7,player.spr,0,0,.05,player.image_xscale,1)),player=null;break;case 3:player.x=this.warpX,player.y=this.warpY}}move(){if(this.timer>0){if(this.timer-=1,1===this.k)if(Math.abs(this.px-this.warpX)<1&&Math.abs(this.py-this.warpY)<1)this.timer=0;else{var s=(this.warpX-this.px)/4,t=(this.warpY-this.py)/4;s>40&&(t=t/s*40,s=40),t>40&&(s=s/t*40,t=40),this.px+=s,this.py+=t,0===ViewMode?(ViewX=Math.min(RoomW-800,Math.max(0,800*(this.px/800<<0))),ViewY=Math.min(RoomH-608,Math.max(0,608*(this.py/608<<0)))):(toVX=Math.max(400,Math.min(this.px,RoomW-400))-400,toVY=Math.max(304,Math.min(this.py,RoomH-304))-304),ViewX===PViewX&&ViewY===PViewY||activate(),this.timer&&objEf.push(new objParticle(this.px-1,this.py-7,sprPlayerFall))}else 2===this.k&&(this.sc+=10,this.ang+=.075);if(0===this.timer)switch(player=new objPlayer(this.warpX,this.warpY),player.jumpNum=this.savejn,this.k){case 0:toFlAl=0,FlashSpd=4;break;case 2:FlashCol='#000',FlashSpd=5,FlashAl=100,toFlAl=0,WarpR=null}}0!==this.spd&&(this.img_ang+=this.spd)}draw_self(s){draw_sprite_angle(s,this.spr[0],this.cX,this.cY,this._ang,16,16),edit&&void 0!==this.id&&(scr.globalAlpha=.7,scr.beginPath(),scr.moveTo(this.cX,this.cY),scr.lineTo(this.warpX,this.warpY),scr.arc(this.warpX,this.warpY,1,0,2*PI),scr.arc(this.warpX,this.warpY,2,0,2*PI),scr.stroke(),scr.globalAlpha=1)}get img_ang(){return this._ang}set img_ang(s){this._ang=s,this.setWH()}get x(){return this._x}set x(s){this._x=s,this.cX=s+16}get y(){return this._y}set y(s){this._y=s,this.cY=s+16}setWH(){var s=this._ang*PI/180;let t=16*Math.sin(s),i=16*Math.cos(s);this.drawW=Number(Math.max(Math.abs(i-t),Math.abs(i+t)).toFixed(0)),this.drawH=this.drawW}},objBlock=class{constructor(s,t,i,h){objInit(this,block,sprFloor,s,t,i,h),this.hspeed=0,this.vspeed=0}setScale(s,t){this.w=Math.max(32,32*Math.round(s/32)),this.h=Math.max(32,32*Math.round(t/32))}draw_self(){if(edit)var s=scr;else s=scrT;if(1===Theme)s.strokeStyle=SprCol,s.strokeRect(this.x+.5,this.y+.5,this.w-1,this.h-1);else for(var t=this.x;t<this.x+this.w;t+=32)for(var i=this.y;i<this.y+this.h;i+=32)i===this.y?s.drawImage(sprFloor[0],t,i):s.drawImage(sprBlock[0],t,i)}},objBreakableBlock=class{constructor(s,t){objInit(this,block,sprBBlock,s,t,32,32)}draw_self(){scr.drawImage(sprBBlock[0],this.x,this.y)}},objSpike=class{constructor(s,t,i){objInit(this,spike,sprSpike,s,t),this.xp=s,this.yp=t,this.sprX=16,this.sprY=16,this.pxmask=!0,this._ang=i,this.img_ang=i}setScale(s,t){this.sprX=s/2,this.sprY=t/2,this.w=s,this.h=t,this.setWH()}draw_self(s){this.x===this.xp&&this.y===this.yp||this.setWH(),this.xp=this.x,this.yp=this.y;var t=this._ang*PI/180;s.save(),s.rotate(-t),(Math.abs(this.scX)<1||Math.abs(this.scY)<1)&&(s.imageSmoothingEnabled=!0),s.drawImage(sprSpike[0],this.dX,this.dY,this.w,this.h),s.restore(),s.imageSmoothingEnabled=!1}get img_ang(){return this._ang}set img_ang(s){this._ang=s,this.setWH()}setWH(){var{x:s,y:t,sprX:i,sprY:h}=this,e=this._ang*PI/180;let r=Math.sin(e),a=Math.cos(e);this.dX=s*a-t*r+i*(a-r-1),this.dY=t*a+s*r+h*(a+r-1);let p=i*a,o=h*r;this.cX=this.dX*a+this.dY*r+p+o,this.drawW=Number(Math.max(Math.abs(o-p),Math.abs(o+p)).toFixed(0)),p=h*a,o=i*r,this.cY=this.dY*a-this.dX*r+p-o,this.drawH=Number(Math.max(Math.abs(o-p),Math.abs(o+p)).toFixed(0))}},objPlayer=class{constructor(s,t){this.x=s,this.y=t,this.w=32,this.h=32,this.Ox=17,this.Oy=23,this.cL=-5,this.cT=-12,this.cW=11,this.cH=21,this.pxmask=!1,this.spr=sprPlayerIdle,this.sprName='i',this.image_number=4,this.ind=0,this.img_spd=.2,this.image_xscale=1,this.maxSpeed=3,this.maxVspeed=9,this.jumpNum=JumpNum,this.djump=this.jumpNum,this.jump1=-8.5,this.jump2=-7,this.hspeed=0,this.vspeed=0,this.Ghspeed=0,this.friction=.5,this.pfhspeed=0,this.pfvspeed=0,this.onPlatform=!1,this.shoottime=0,this.hspdR=0,this.hspdL=0,this.gravity=.4}place_meeting(s,t,i,h){var e=roundFix(s+this.cL),r=roundFix(t+this.cT);return i===warpEnd?!!colRect(e,r,this.cW,this.cH,i.cX-i.drawW,i.cY-i.drawH,i.drawW<<1,i.drawH<<1)&&colRP(e,r,this.cW,this.cH,i):colRO(e,r,this.cW,this.cH,i,h)}place_free(s,t){var i=roundFix(s+this.cL),h=roundFix(t+this.cT);return!colRO(i,h,this.cW,this.cH,block)}evStep(){if(this.gravity=.4,this.maxSpeed=3,l=this.place_meeting(this.x,this.y,field))switch(l.f){case 0:this.gravity=.2;break;case 1:this.gravity=.7;break;case 2:this.maxSpeed=6;break;case 3:this.maxSpeed=1}var s=keyboard_check(vk_left),t=keyboard_check(vk_right);if(t||(t=-s),t){var i=Math.round(this.x+this.cL-1),h=Math.round(this.y+this.cT-1),e=!0;(l=colRO(i,h,this.cW+2,this.cH+2,Walljump))&&(e=t===l.side),e&&(this.image_xscale=t,this.hspeed=this.maxSpeed*t,this.spr=sprPlayerRun,this.sprName='r',this.img_spd=.5)}else this.hspeed=0,this.spr=sprPlayerIdle,this.sprName='i',this.img_spd=.2;if(this.vspeed>this.maxVspeed&&(this.vspeed=this.maxVspeed),!this.onPlatform&&this.place_free(this.x,this.y+1)&&(this.vspeed<0?(this.spr=sprPlayerJump,this.sprName='j'):(this.spr=sprPlayerFall,this.sprName='f'),this.img_spd=.2),this.inWater=!1,this.place_meeting(this.x,this.y,water)&&(this.inWater=!0,this.vspeed>2&&(this.vspeed=2)),l=this.place_meeting(this.x,this.y+1,block))switch(l.__proto__.constructor.name){case'objIceBlock':this.hspeed>0?(this.hspdR=this.hspeed,this.hspeed-=Math.round(this.hspdL)):this.hspeed<0?(this.hspdL=-this.hspeed,this.hspeed+=Math.round(this.hspdR)):this.hspeed+=Math.round(this.hspdR-this.hspdL),this.hspdR>0&&(this.hspdR-=.1),this.hspdL>0&&(this.hspdL-=.1);break;default:this.hspdR=0,this.hspdL=0}else this.hspdR=0,this.hspdL=0;if((l=this.place_meeting(this.x,this.y,GMColObj))&&l.evCol(),l=this.place_meeting(this.x,this.y+1,conveyor,!0)){var[r,a,p,o]=[0,0,0,0];l.forEach(s=>{0===s.fx?s.spd>0?r=Math.max(r,s.spd):a=Math.min(a,s.spd):s.spd>0?p=Math.max(p,s.spd):o=Math.min(o,s.spd)}),player.hspeed+=r+a;var d=p+o;d>0?player.vspeed<d&&(player.vspeed+=d):player.vspeed>d&&(player.vspeed+=d)}if(0===this.shoottime&&keyboard_check_pressed(vk_Z)&&(bullet.push(new objBullet(this.x,this.y)),sndPlay(sndShoot),this.shoottime=5),this.shoottime&&(this.shoottime-=1),keyboard_check_pressed(vk_shift))if(!this.place_free(this.x,this.y+1)||this.onPlatform||this.place_meeting(this.x,this.y+1,platform))this.vspeed=this.jump1,sndPlay(sndJump),this.djump=this.jumpNum;else if((this.djump>0||this.inWater)&&(this.vspeed=this.jump2,this.djump&&(this.djump-=1),sndPlay(sndJump,2),this.jumpNum>1&&this.djump<this.jumpNum-1))for(let s=0;s<3;s++){let s=Math.random()/10+.1,t=2*Math.random()*PI,i=10*Math.random()-5,h=Math.random()/100+.02;objEf.push(new objParticle(this.x+i,this.y+4,sprPStar,s,t,h))}keyboard_check_released(vk_shift)&&this.vspeed<0&&(this.vspeed*=.45);var l,c=this.place_free(this.x,this.y+1);i=Math.round(this.x+this.cL-1),h=Math.round(this.y+this.cT-1);c&&((l=colRO(i,h,this.cW+2,this.cH+2,Walljump))&&(this.vspeed=2,this.spr=sprPlayerSlide,this.sprName='s',this.img_spd=.5,this.image_xscale=l.side,(keyboard_check_pressed(vk_right)&&1===l.side||keyboard_check_pressed(vk_left)&&-1==l.side)&&(keyboard_check(vk_shift)?(this.spr=sprPlayerJump,this.sprName='j',this.img_spd=.2,this.vspeed=-9,this.hspeed=15*l.side,sndPlay(sndWallJump)):(this.spr=sprPlayerFall,this.sprName='f',this.img_spd=.2,this.hspeed=3*l.side))))}move(){(this.ind+=this.img_spd,this.ind=this.ind%this.spr.length,this.vspeed+=this.gravity,this.Ghspeed>0?(this.Ghspeed-=this.friction,this.Ghspeed<0&&(this.Ghspeed=0)):this.Ghspeed<0&&(this.Ghspeed+=this.friction,this.Ghspeed>0&&(this.Ghspeed=0)),this.hspeed+=this.Ghspeed,this.x+=this.hspeed,this.y+=this.vspeed,this.onPlatform)&&((r=this.place_meeting(this.x,this.y+4,platform,!0))&&r.includes(this.onPlatform)||(this.onPlatform=!1));if((e=this.place_meeting(this.x,this.y+2,platform,!0))&&this.place_free(this.x,this.y))for(var s=0;s<e.length;s++)this.pfhspeed+=e[s].hspeed,this.x+=e[s].hspeed;if(this.onPlatform&&this.place_meeting(this.x,this.y,platform)){var t=this.y,i=this.onPlatform.y-9,h=this.vspeed;this.onPlatform.vspeed>0?(this.vspeed=this.onPlatform.vspeed,this.pfvspeed=i-this.y):(this.vspeed=0,this.pfvspeed=0),this.y=i}var e,r,a=!1;if(!this.place_free(this.x,this.y)){var p=this.hspeed+this.pfhspeed,o=this.vspeed+this.pfvspeed;if(this.x-=p,this.y-=o,0!==p&&!this.place_free(this.x+p,this.y)){for(var d=sign(p);this.place_free(this.x+d,this.y);)this.x+=d;this.hspeed=0,p=0,this.Ghspeed=0}if(0!==o&&!this.place_free(this.x,this.y+o)){for(var l=sign(o),c=0;this.place_free(this.x,this.y+l)&&c<Math.abs(o);)this.y+=l,c++;o>0&&(this.djump=this.jumpNum),this.vspeed=0,o=0,a=!0}0===p&&0===o||this.place_free(this.x+p,this.y+o)||(this.hspeed=0,p=0),this.x+=p,this.y+=o}if(this.pfhspeed=0,this.pfvspeed=0,this.onPlatform)(r=this.place_meeting(this.x,this.y+4,platform,!0))&&r.includes(this.onPlatform)?this.djump=this.jumpNum:(this.onPlatform=!1,a||void 0===t||(this.vspeed=h,this.y=t));else if(e=this.place_meeting(this.x,this.y,platform,!0))for(s=0;s<e.length;s++)if(!this.onPlatform&&this.y-this.vspeed/2<=e[s].y&&this.place_free(this.x-this.hspeed,this.y-this.vspeed)){this.onPlatform=e[s],this.y=this.onPlatform.y-9,this.vspeed=this.onPlatform.vspeed;break}(this.place_meeting(this.x,this.y,block)&&killPlayer(),this.place_meeting(this.x,this.y,spike)&&killPlayer(),this.place_meeting(this.x,this.y,cherry)&&killPlayer(),(this.x<0||this.x>RoomW||this.y<0||this.y>RoomH)&&(2===OutMode?this.x>RoomW?this.x-=RoomW:this.x<0?this.x+=RoomW:this.y>RoomH?this.y-=RoomH:this.y<0&&(this.y+=RoomH):3===OutMode?this.x>RoomW?this.x-=RoomW:this.x<0?this.x+=RoomW:killPlayer():4===OutMode?this.y>RoomH?this.y-=RoomH:this.y<0?this.y+=RoomH:killPlayer():killPlayer()),player)&&(this.place_meeting(this.x,this.y,warpEnd)?GameEnd():(r=this.place_meeting(this.x,this.y,warp))&&r.Warp())}draw_self(){this.image_xscale<0?(scr.save(),scr.scale(-1,1),scr.drawImage(this.spr[this.ind<<0],-this.x-this.Ox,this.y-this.Oy),scr.restore()):scr.drawImage(this.spr[this.ind<<0],this.x-this.Ox,this.y-this.Oy)}},objSavePoint=class{constructor(s,t){objInit(this,GMStepObj,sprSave,s,t),this.img_spd=0,this.ind=0}evStep(){player&&(keyboard_check_pressed(vk_S)||keyboard_check_pressed(vk_Z))&&colRect(this.x,this.y,this.w,this.h,player.x+player.cL,player.y+player.cT,player.cW,player.cH)&&(saveX=player.x,saveY=player.y,JumpNum=player.jumpNum,SAVE=this.id,void 0!==RECT&&(SRECT=RECT,SRECO={...RECO}),keyPause(),saveEf=[],save_ef(),room_load(!0,!0)),this.ind+=this.img_spd,this.ind>2&&(this.img_spd=0,this.ind=0)}draw_self(){scr.drawImage(this.spr[this.ind%2<<0],this.x,this.y)}},objBullet=class{constructor(s,t){this.x=s,this.y=t,this.spr=sprBullet,centerSpr(this),this.hspeed=16*player.image_xscale,this.ind=0,this.id=bullet.length}evStep(){this.ind>40&&destroy(bullet,this.id);var s=colRO(this.x-2,this.y-2,4,4,block);s&&('objBreakableBlock'===s.__proto__.constructor.name&&(breakEF(s),destroy(block,s.id)),destroy(bullet,this.id)),this.x+=this.hspeed,this.ind+=1}draw_self(){scr.drawImage(this.spr[this.ind%2],this.x-this.Ox,this.y-this.Oy)}},objBlood=class{constructor(s,t){this.x=s,this.y=t,this.al=1,this.ind=3*Math.random()<<0,this.tosc=25*Math.random()+25,this.gravity=Math.random()/2+.5,this.toal=Math.random()/6+.3,this.sc=0,this.spd=5*Math.random()+1.5,this.dir=2*Math.random()*PI,this.spr=sprBlood}draw_self(){if(this.sc>20&&(this.x+this.sc<0||this.x-this.sc>RoomW||this.y+this.sc<0||this.y-this.sc>RoomH))return!1;this.sc<this.tosc&&(this.sc+=.5),this.al>this.toal&&(this.al-=.04),this.gravity>.2&&(this.gravity-=.02),this.spd>0&&(this.x+=this.spd*Math.cos(this.dir),this.y+=this.spd*Math.sin(this.dir),this.spd-=.05),this.y+=this.gravity,scr.globalAlpha=this.al,scr.drawImage(this.spr[this.ind],this.x-this.sc,this.y-this.sc,2*this.sc,2*this.sc),scr.globalAlpha=1}},objPlatform=class{constructor(s,t){objInit(this,platform,sprPlatform,s,t,32,16),this.pxmask=!1,this.hspeed=0,this.vspeed=0}evStep(){if(0===this.hspeed&&0===this.vspeed)return!1;var s,t=!1,i=!1;((s=colRO(this.x+this.hspeed,this.y,this.w,this.h,block))&&'objCrate'!==s.__proto__.constructor.name&&(this.hspeed=-this.hspeed,t=!0),(s=colRO(this.x,this.y+this.vspeed,this.w,this.h,block))&&'objCrate'!==s.__proto__.constructor.name&&(this.vspeed=-this.vspeed,i=!0),t||i)||(s=colRO(this.x+this.hspeed,this.y+this.vspeed,this.w,this.h,block))&&'objCrate'!==s.__proto__.constructor.name&&(this.hspeed=-this.hspeed)}move(){this.x+=this.hspeed,this.y+=this.vspeed}draw_self(){scr.drawImage(this.spr[0],this.x,this.y)}},objWater=class{constructor(s,t,i,h){objInit(this,water,sprWater,s,t,i,h),this.pxmask=!1}setScale(s,t){this.w=Math.max(32,32*Math.round(s/32)),this.h=Math.max(32,32*Math.round(t/32))}draw_self(){scr.drawImage(this.spr[0],this.x,this.y,this.w,this.h)}},objCherry=class{constructor(s,t,i,h){objInit(this,cherry,sprCherry,s,t,21,24),this.Ox=10,this.Oy=12,this.pxmask=!0,this.hspeed=0,this.vspeed=0,void 0===i?this.move=this.move1:(this.rid=i,this.dir=h,this.move=this.move2)}place_nfree(s,t){for(var i=s-this.Ox,h=t-this.Oy,e=0;e<block.length;e++)if('objCrate'!==block[e].__proto__.constructor.name&&colRect(i,h,this.w,this.h,block[e].x,block[e].y,block[e].w,block[e].h))return!0;return!1}move1(){if(0===this.hspeed&&0===this.vspeed)return!1;this.place_nfree(this.x+this.hspeed,this.y)&&(this.hspeed=-this.hspeed),this.place_nfree(this.x,this.y+this.vspeed)&&(this.vspeed=-this.vspeed),this.x+=this.hspeed,this.y+=this.vspeed,(this.x<=-11||this.y<=-12||this.x>=RoomW+10||this.y>=RoomH+12)&&destroy(this.obj_ind,this.id)}move2(){this.x=Rcherry[this.rid].x+Rcherry[this.rid].r*Math.cos(DtoR(Rcherry[this.rid].ang)+this.dir),this.y=Rcherry[this.rid].y-Rcherry[this.rid].r*Math.sin(DtoR(Rcherry[this.rid].ang)+this.dir)}draw_self(s){this.ind=cherry.ind,s.drawImage(this.spr[this.ind<<0],this.x-this.Ox,this.y-this.Oy)}},objWallJump=class{constructor(s,t,i){objInit(this,Walljump,sprWallJump,s,t,14,32),this.side=i,this.pxmask=!1}draw_self(){edit?scr.drawImage(this.spr[0],this.x,this.y):scrT.drawImage(this.spr[0],this.x,this.y)}},objRoundingCherry=class{constructor(s,t){objInit(this,Rcherry,sprRCherry,s,t,21,24),this.Ox=10,this.Oy=12,this.ang=0,this.n=6,this.r=64,this.spd=1}createR(){for(var s=0;s<this.n;s++)cherry.push(new objCherry(this.x,this.y,this.id,s/this.n*2*PI))}evDes(){for(var s=0;s<cherry.length;s++)cherry[s].rid===this.id&&(destroy(cherry,s),s-=1)}move(){this.ang+=this.spd,this.ang=this.ang%360}draw_self(){scr.beginPath(),scr.strokeStyle='gray',scr.arc(this.x,this.y,this.r,0,2*PI),scr.stroke(),scr.globalAlpha=.5;for(var s,t,i=DtoR(this.ang),h=0;h<this.n;h++)s=this.x+this.r*Math.cos(i),t=this.y-this.r*Math.sin(i),scr.drawImage(sprCherry[0],s-this.Ox,t-this.Oy),i+=2*PI/this.n;scr.globalAlpha=1,scr.drawImage(this.spr[0],this.x-this.Ox,this.y-this.Oy)}},objCrate=class{constructor(s,t){objInit(this,block,sprCrate,s,t,32,32),this.onPlat=!1,this.gravity=.5,this.hspeed=0,this.vspeed=0}move(){this.vspeed+=this.gravity;var s=!1,t=this.vspeed===this.gravity;if(player&&(0!==this.hspeed||0!==player.hspeed)){var i=Math.round(player.x+player.cL+player.hspeed),h=Math.round(player.y+player.cT);colRect(i,h,player.cW,player.cH,this.x+this.hspeed,this.y,this.w,this.h)&&(this.hspeed-=sign(this.hspeed-player.hspeed))}0!==this.hspeed&&colRO(this.x+this.hspeed,this.y,this.w,this.h,block,!1,this.id)&&(this.hspeed=0);var e=colRO(this.x,this.y+this.vspeed,this.w,this.h,block,!1,this.id);e&&(this.vspeed>0?(this.y=e.y-32,this.vspeed=0,s=!0):this.vspeed<0&&(this.y=e.y+e.h,this.vspeed=0)),t&&s&&(this.x+=this.hspeed),this.y+=this.vspeed,this.y>RoomH&&destroy(block,this.id)}draw_self(){this.hspeed=0,scr.drawImage(this.spr[0],this.x,this.y)}},objParticle=class{constructor(s,t,i,h=0,e=0,r=.1,a=1,p=1){this.x=s,this.y=t,this.spr=i,this.spd=h,this.dir=e,this.xs=a,this.ys=p,this.al=1,this.alspd=r,this.O=this.spr[0].width/2,this.id=objEf.length}move(){void 0!==this.vspd?(this.vspd+=this.grav,this.x+=this.hspd,this.y+=this.vspd):(this.x+=this.spd*Math.cos(this.dir),this.y-=this.spd*Math.sin(this.dir)),this.al-=this.alspd,this.al<=0&&destroy(objEf,this.id)}draw_self(){scr.save(),scr.scale(this.xs,this.ys),scr.globalAlpha=this.al,scr.drawImage(this.spr[0],this.x/this.xs-this.O,this.y/this.ys-this.O),scr.globalAlpha=1,scr.restore()}},objJumpRefresher=class{constructor(s,t){this.x=s,this.y=t,this.spr=sprJR,centerSpr(this),this.obj_ind=GMColObj,this.id=GMColObj.length}evCol(){0===player.djump&&(player.djump=1),sndPlay(sndExtraJump),destroy(GMColObj,this.id)}draw_self(){edit&&centerSpr(this),scr.drawImage(this.spr[0],this.x-this.Ox,this.y-this.Oy)}},objJumpChanger=class{constructor(s,t,i){var h;switch(i){case 1/0:h=sprIJump,this.snd=sndGainJump;break;case 2:h=sprTJump,this.snd=sndGainJump;break;case 1:h=sprDJump,this.snd=sndLoseJump;break;case 0:h=sprSJump,this.snd=sndLoseJump}objInit(this,GMColObj,h,s,t,32,32),this.num=i,this.drawEf=0,this.pxmask=!0}evCol(){player.jumpNum!==this.num&&(player.djump+=this.num-player.jumpNum,player.jumpNum=this.num,sndPlay(this.snd),this.drawEf=25)}draw_self(s){if(s.drawImage(this.spr[0],this.x,this.y),s===scr&&this.drawEf>0){var t=.8*(45-this.drawEf);scr.globalAlpha=this.drawEf/25,scr.drawImage(this.spr[0],this.x+16-t,this.y+16-t,2*t,2*t),scr.globalAlpha=1,this.drawEf-=1}}},objIceBlock=class{constructor(s,t,i,h){objInit(this,block,sprFloor,s,t,i,h)}setScale(s,t){this.w=Math.max(32,32*Math.round(s/32)),this.h=Math.max(32,32*Math.round(t/32))}draw_self(){if(edit)var s=scr;else s=scrT;if(1===Theme){s.strokeStyle=SprCol,s.strokeRect(this.x+.5,this.y+.5,this.w-1,this.h-1);for(var t=this.x;t<this.x+this.w;t+=32)s.drawImage(sprIce[0],t,this.y)}else for(t=this.x;t<this.x+this.w;t+=32)for(var i=this.y;i<this.y+this.h;i+=32)i===this.y?(s.drawImage(sprFloor[0],t,i),s.drawImage(sprIce[0],t,i)):s.drawImage(sprBlock[0],t,i)}},objSpikeGear=class{constructor(s,t){objInit(this,Rcherry,sprSG,s,t,24,24),this.Ox=12,this.Oy=12,this.ang=0,this.n=4,this.r=32,this.l=32,this.spd=1}createR(){this.n<3?this.l=this.r/2:this.l=16/Math.tan(PI/this.n)+this.r/2;for(var s=0;s<this.n;s++){let t=spike.push(new objMovingSpike(this.x,this.y,s/this.n*360-90+this.ang));spike[t-1].rid=this.id,spike[t-1].dir=s/this.n*2*PI+DtoR(this.ang),spike[t-1].setScale(32,this.r)}}evDes(){for(var s=0;s<spike.length;s++)spike[s].rid===this.id&&(destroy(spike,s),s-=1)}move(){this.ang+=this.spd,this.ang=this.ang%360}draw_self(){scr.globalAlpha=.6;var s,t,i=DtoR(this.ang);this.l=16/Math.tan(PI/this.n)+this.r/2;for(var h=0;h<this.n;h++)s=this.x+this.l*Math.cos(i),t=this.y-this.l*Math.sin(i),draw_sprite_angle(scr,sprSpike[0],s,t,i/PI*180-90,16,this.r/2,1,this.r/32),i+=2*PI/this.n;scr.globalAlpha=1,scr.drawImage(this.spr[0],this.x-this.Ox,this.y-this.Oy)}},objMovingSpike=class{constructor(s,t,i){objInit(this,spike,sprSpike,s,t,32,32),this.sprX=16,this.sprY=16,this.pxmask=!0,this._ang=i,this.img_ang=i}setScale(s,t){this.sprX=s/2,this.sprY=t/2,this.w=s,this.h=t,this.setWH()}move(){if(void 0!==this.rid){let s=DtoR(Rcherry[this.rid].ang)+this.dir;this.x=Rcherry[this.rid].x+Rcherry[this.rid].l*Math.cos(s),this.y=Rcherry[this.rid].y-Rcherry[this.rid].l*Math.sin(s),this.img_ang=s/PI*180-90}}draw_self(s){draw_sprite_angle(s,this.spr[0],this.x,this.y,this._ang,this.sprX,this.sprY,this.w/32,this.h/32)}get img_ang(){return this._ang}set img_ang(s){this._ang=s,this.setWH()}setWH(){var{x:s,y:t,sprX:i,sprY:h}=this,e=this._ang*PI/180;let r=Math.sin(e),a=Math.cos(e);this.cX=s,this.cY=t;let p=i*a,o=h*r;this.drawW=Number(Math.max(Math.abs(o-p),Math.abs(o+p)).toFixed(0)),p=h*a,o=i*r,this.drawH=Number(Math.max(Math.abs(o-p),Math.abs(o+p)).toFixed(0))}},objBoard=class{constructor(s,t,i=""){objInit(this,board,sprBoard,s,t),this.txt=i,this.pxmask=!1,this.op=!1}on(){Bd.innerHTML=`<pre><xmp>${this.txt}</xmp></pre>`,Bd.style.visibility='visible',GC.style.visibility='hidden',GO.style.visibility='hidden',GUI.style.transition="opacity 0.5s",GUI.style.visibility='visible',GUI.style.opacity='1',this.op=!0}off(){Bd.style.visibility='hidden',GUI.style.visibility='hidden',GUI.style.opacity='0',this.op=!1,GUI.style.transition="none"}move(){player&&(player.x>this.x&&player.x<this.x+32&&player.y>this.y&&player.y<this.y+32?(keyboard_check_pressed(vk_up)&&this.on(),keyboard_check_pressed(vk_down)&&this.off()):this.op&&this.off())}draw_self(){edit?scr.drawImage(this.spr[0],this.x,this.y):scrT.drawImage(this.spr[0],this.x,this.y)}};Conveyor=1;const objConveyor=class{constructor(s,t){objInit(this,conveyor,sprConveyor,s,t),this.spd=1,this.pxmask=!1,this.fx=0,this.sx=-32,this.CW=32}get CW(){return this._w}set CW(s){this._w=s,0===this.fx?this.w=s:this.h=s}setScale(s,t){0===this.fx?this.CW=Math.max(32,s):this.CW=Math.max(32,t)}move(){this.sx+=Math.abs(this.spd),this.sx>0&&(this.sx-=32)}draw_self(){if(scr.fillStyle=fillCoveyor,scr.save(),1===this.fx){scr.rotate(PI/2);let s=this.x+32;this.x=this.y,this.y=-s}var s=0;if(this.spd<0&&(scr.scale(-1,1),s=2*this.x+this._w),scr.translate(this.x+this.sx-s,this.y),scr.fillRect(-this.sx,0,this._w,32),1===this.fx){let s=this.y+32;this.y=this.x,this.x=-s}scr.restore()}};Spring=10;const objSpring=class{constructor(s,t){objInit(this,GMColObj,sprSpring,s,t),centerSpr(this,!0),this.ang=0,this.ind=0,this.spd=Spring,this.pxmask=!0}evCol(){0===this.ind&&(this.ind=1,sndPlay(sndSpring),player.vspeed=-this.spd*Math.cos(DtoR(this.ang)),player.Ghspeed=-this.spd*Math.sin(DtoR(this.ang)))}draw_self(s){edit&&centerSpr(this,!0),draw_sprite_angle(s,this.spr[this.ind],this.x,this.y,this.ang,this.sprX,this.sprY,1,1)}};Trampoline=8;const objTrampoline=class{constructor(s,t){objInit(this,GMColObj,sprTp,s,t),centerSpr(this,!0),this.ang=0,this.ind=0,this.spd=Trampoline,this.pxmask=!0}evCol(){player.vspeed=-this.spd*Math.cos(DtoR(this.ang)),player.Ghspeed=-this.spd*Math.sin(DtoR(this.ang))}draw_self(s){edit&&centerSpr(this,!0),draw_sprite_angle(s,this.spr[this.ind],this.x,this.y,this.ang,this.sprX,this.sprY,1,1)}},objField=class{constructor(s,t,i,h,e){var r;switch(this.f=e,e){case 0:r=sprLGrav,this.fs=fillLGrav;break;case 1:r=sprHGrav,this.fs=fillHGrav;break;case 2:r=sprFSpd,this.fs=fillFSpd;break;case 3:r=sprSSpd,this.fs=fillSSpd}objInit(this,field,r,s,t,i,h),this.pxmask=!1,this.sx=0}setScale(s,t){this.w=Math.max(32,32*Math.round(s/32)),this.h=Math.max(32,32*Math.round(t/32))}move(){switch(this.f){case 0:this.sx-=1.2,this.sx<-32&&(this.sx+=32);break;case 1:case 2:this.sx+=1.2,this.sx>0&&(this.sx-=32);break;case 3:this.sx-=.8,this.sx<-32&&(this.sx+=32)}}draw_self(){this.f>1?(scr.save(),scr.translate(this.x+this.sx,this.y),scr.fillStyle=this.fs,scr.fillRect(-this.sx,0,this.w,this.h),scr.restore()):(scr.save(),scr.translate(this.x,this.y+this.sx),scr.fillStyle=this.fs,scr.fillRect(0,-this.sx,this.w,this.h),scr.restore())}},objSaveEf=class{constructor(s,t){this.x=s,this.y=t,this.l=s,this.t=t;var i=2*(1+Math.random()),h=Math.random()*PI*2;this.hspeed=i*Math.cos(h),this.vspeed=i*Math.sin(h),this.grav=(Math.random()+2)/10,this.al=1}draw_self(){if(this.al-=.05,this.al<=0)return!1;this.vspeed+=this.grav,this.x+=this.hspeed,this.y+=this.vspeed,scr.globalAlpha=this.al,scr.drawImage(scref,this.l,this.t,200,152,ViewX+this.x,ViewY+this.y,200,152),scr.globalAlpha=1}},objBKEF=class{constructor(s,t,i,h){this.id=BKEF.length,this.k=i,this.s=h,this.x=s,this.y=t,this.h=0,this.v=0,this.a=Math.random()*Math.PI,this.aspd=0}move(){this.y+=this.v,this.x+=this.h,0!==this.k&&2!==this.k&&6!==this.k||(this.a+=this.aspd),(this.x+this.s<0||this.x-this.s>800||this.y+this.s<0||this.y-this.s>608)&&destroy(BKEF,this.id)}draw0(){let s=scr;s.save(),s.translate(this.x+ViewX,this.y+ViewY),0!==this.a&&s.rotate(this.a);let t=-this.s>>1;s.rect(t,t,this.s,this.s),s.restore()}draw1(){let s=scr,t=this.x+ViewX;var i=this.y+ViewX;let h=this.s>>1;s.moveTo(t+h,i),s.arc(t,i,h,0,2*Math.PI)}draw2(){let s=scr;s.save(),s.translate(this.x+ViewX,this.y+ViewY),0!==this.a&&s.rotate(this.a);let t=-this.s>>1;s.fillRect(t,t,this.s,this.s),s.restore()}draw3(){let s=scr;s.save(),s.translate(this.x+ViewX,this.y+ViewY),0!==this.a&&s.rotate(this.a);let t=-this.s>>1;s.drawImage(sprPt[this.k-4],t,t,this.s,this.s),s.restore()}},objFake=class{constructor(s,t,i){switch(i){case 0:objInit(this,GMColObj,sprFloor,s,t,32,32),this.img_ind=0;break;case 1:objInit(this,GMColObj,sprBlock,s,t,32,32),this.img_ind=0;break;case 2:objInit(this,GMColObj,sprPlatform,s,t,32,16),this.img_ind=1}this.pxmask=!1,this.ind=i}evCol(){breakEF(this),destroy(this.obj_ind,this.id)}draw_self(){scr.drawImage(this.spr[0],this.x,this.y),edit&&scr.drawImage(sprFake[this.img_ind],this.x,this.y)}},objShooter=class{constructor(s,t,i=0){objInit(this,shooter,sprShooter,s,t,24,24),this.Ox=12,this.Oy=12,this.ang=0,this.n=3===i?15:12,this.t=0,this.spd=4,this.mode=i}move(){if(0==this.t--){let s=this.ang*Math.PI/180;switch(this.mode){case 0:for(let t=this.n;t--;){let t=new objCherry(this.x,this.y);t.hspeed=this.spd*Math.cos(s),t.vspeed=-this.spd*Math.sin(s),t.inView=!0,cherry.push(t),s+=2*Math.PI/this.n}break;default:let t,i,h,e,r=this.mode+2,a=2*Math.PI/r,p=s+Math.PI-a/4*this.mode,o=2*this.spd*Math.sin(Math.PI/r)*r/this.n,d=0;for(let l=0;l<this.n;l++){l>=d&&(t=this.spd*Math.cos(s),i=-this.spd*Math.sin(s),h=o*Math.cos(p),e=-o*Math.sin(p),s+=a,p+=a,d+=this.n/r);let c=new objCherry(this.x,this.y);c.hspeed=t,c.vspeed=i,c.inView=!0,cherry.push(c),t+=h,i+=e}}destroy(this.obj_ind,this.id)}}draw_self(){scr.drawImage(this.spr[this.mode],this.x-this.Ox,this.y-this.Oy)}};